<!DOCTYPE html>
<html>
  <head>
    <title>Real-Time Date Blocking Test</title>
    <style>
      body {
        font-family: monospace;
        padding: 20px;
        background: #f5f5f5;
      }
      .test-box {
        background: white;
        padding: 20px;
        margin: 10px 0;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .date-blocked {
        display: inline-block;
        padding: 5px 10px;
        margin: 5px;
        background: #ffebee;
        border: 2px solid #f44336;
        border-radius: 4px;
        color: #d32f2f;
        font-weight: bold;
      }
      .date-available {
        display: inline-block;
        padding: 5px 10px;
        margin: 5px;
        background: #e8f5e9;
        border: 2px solid #4caf50;
        border-radius: 4px;
        color: #2e7d32;
        font-weight: bold;
      }
      button {
        padding: 10px 20px;
        background: #667eea;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #5568d3;
      }
      .json-output {
        background: #263238;
        color: #aed581;
        padding: 15px;
        border-radius: 5px;
        overflow-x: auto;
        margin: 10px 0;
      }
    </style>
  </head>
  <body>
    <h1>üîç Real-Time Date Blocking Debug</h1>

    <div class="test-box">
      <h3>Current Reservation in Database:</h3>
      <div id="db-info">Loading...</div>
    </div>

    <div class="test-box">
      <h3>Test API for Each Booking Type:</h3>
      <button onclick="testAll()">Test All Booking Types</button>
      <div id="api-results"></div>
    </div>

    <div class="test-box">
      <h3>Visual Test - Which dates appear blocked?</h3>
      <p>Testing December 3-7, 2025:</p>
      <div id="visual-test"></div>
    </div>

    <script>
      // Check database first
      async function checkDatabase() {
        const response = await fetch("test_api_response.php");
        const text = await response.text();
        document.getElementById(
          "db-info"
        ).innerHTML = `<pre class="json-output">${text}</pre>`;
      }

      async function testBookingType(type) {
        const response = await fetch("user/get_unavailable_dates.php", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ booking_type: type }),
        });
        return await response.json();
      }

      async function testAll() {
        const resultsDiv = document.getElementById("api-results");
        resultsDiv.innerHTML = "<p>Testing...</p>";

        const types = ["daytime", "nighttime", "22hours"];
        let html = "";

        for (const type of types) {
          const result = await testBookingType(type);
          html += `
                    <div style="margin: 15px 0; padding: 10px; background: #f5f5f5; border-radius: 5px;">
                        <strong style="font-size: 1.2em; color: #667eea;">${type.toUpperCase()}</strong><br>
                        <div style="margin-top: 10px;">
                            <strong>Success:</strong> ${result.success}<br>
                            <strong>Count:</strong> ${result.count}<br>
                            <strong>Unavailable Dates:</strong><br>
                            <pre class="json-output">${JSON.stringify(
                              result.unavailable_dates,
                              null,
                              2
                            )}</pre>
                        </div>
                    </div>
                `;
        }

        resultsDiv.innerHTML = html;
        visualTest();
      }

      async function visualTest() {
        const testDates = [
          "2025-12-03",
          "2025-12-04",
          "2025-12-05",
          "2025-12-06",
          "2025-12-07",
        ];
        const result = await testBookingType("daytime");
        const blockedDates = result.unavailable_dates || [];

        let html = '<div style="margin-top: 10px;">';
        testDates.forEach((date) => {
          const isBlocked = blockedDates.includes(date);
          const className = isBlocked ? "date-blocked" : "date-available";
          const status = isBlocked ? "‚ùå BLOCKED" : "‚úÖ AVAILABLE";
          html += `<div class="${className}">${date} ${status}</div>`;
        });
        html += "</div>";

        document.getElementById("visual-test").innerHTML += html;
      }

      // Run tests on load
      checkDatabase();
      testAll();
    </script>
  </body>
</html>
